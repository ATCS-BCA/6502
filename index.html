<html>

<head>
	<title>Login</title>
	<link rel="shortcut icon" href="frontend/images/icons/favicon.ico">
</head>

<body>

	<div id="logged-in">
		You are logged in as <span id="login-name"></span>.
		<button id="log-out">Log out</button>
	</div>
	<div id="logged-out">
		You are not logged in.
		<button>Log in</button>
	</div>


	<script src="frontend/js/jquery.min.js"></script>
	<script src="http://ajax.aspnetcdn.com/ajax/mobileservices/MobileServices.Web-1.2.7.min.js"></script>


	<script>
		$(document).ready(function () {
            
            
            function storageAvailable(type) {
	try {
		var storage = window[type],
			x = '__storage_test__';
		storage.setItem(x, x);
		storage.removeItem(x);
		return true;
	}
	catch(e) {
		return false;
	}
}

			
			var client = new WindowsAzure.MobileServiceClient(
    "https://ide6502.azure-mobile.net/",
    "QekgXgsjXlzmhYhjfEhxyySyblCoHg86"
);
				function refreshAuthDisplay() {
    var isLoggedIn = client.currentUser !== null;
    $("#logged-in").toggle(isLoggedIn);
    $("#logged-out").toggle(!isLoggedIn);

    if (isLoggedIn) {
        if (storageAvailable('localStorage')) {
	       localStorage.setItem('id', client.currentUser.clientId.replace("Google:",""));
        }
        else {
            $("#login-name").text("UPGRADE TO HTML5");
        }
        window.location.replace = ("http://6502.azurewebsites.net/frontend/index.html);
    }
}

function logIn() {
    client.login("google").then(refreshAuthDisplay, function(error){
        alert(error);
    });
	

}

function logOut() {
    client.logout();
    refreshAuthDisplay();
    $('#summary').html('<strong>You must login to access data.</strong>');
}

// On page init, fetch the data and set up event handlers
$(function () {
    refreshAuthDisplay();
    $('#summary').html('<strong>You must login to access data.</strong>');          
    $("#logged-out button").click(logIn);
    $("#logged-in button").click(logOut);
});
			});
	</script>
	
	
</body>

</html>